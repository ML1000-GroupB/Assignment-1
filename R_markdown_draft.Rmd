---
title: "preprocessing_census"
author: "Queenie"
date: "31/01/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r message=FALSE}
library(tidyverse)
library(dplyr)
library(reshape2)
library(ggplot2)
library(Hmisc)
library(corrplot)
library(mice)
library(VIM)
library(pROC)
library(caret)
library(sqldf)
library(RColorBrewer)
library(viridis)
```

load data

```{r}
column_names <- c("age", "workclass", "fnl_wgt", "education", "education_num", "marital_status", "occupation", "relationship", "race", "sex", "capital_gain", "capital_loss", "hours_per_week", "native_country", "class")
data <- read.delim(file.choose(), sep =",", header = FALSE, na.strings = c("NA","","#NA"), col.names = column_names)
```

preview dataset:
```{r}
head(data,10)

str(data)

summary(data)
```

check distribution of target variable which is class:
```{r}
table(data$class)
```

look at target variable class:
```{r}
ggplot(data = data) +
  geom_bar(mapping = aes(x = class))
```

testing for missing values:
```{r}
sapply(data, function(x) sum(is.na (x)))
```
to get the numeric columns only:
```{r} 
list_of_numcols = sapply(data, is.numeric)
numcols = data[ , list_of_numcols]

str(data)
str(numcols)
```
histograms for numeric variables:
```{r}
hist(data$age)
```

looking at categorical variables:
```{r}
attach(data)
freq_tbl=table(sex)
head(freq_tbl)
```

to get proportion, input frequency table:
```{r}
prop.table(freq_tbl)
```

looking at education:
```{r}
freq_tbl_education= table(education)
head(freq_tbl_education)
prop.table(freq_tbl_education)
```

look at target variable class with respect to education:
```{r}
freq_xtab=xtabs(~education+class)
head(freq_xtab)
```

cross-tab for 2 categorical features, this time with proportions:
```{r}
prop.table(freq_xtab)
```
use DPLYR to see the relationship between education and education_num:
```{r}
class_by_education =
  data %>% 
  group_by(education) %>%
  summarise(education_num = mean(education_num, na.rm = TRUE))
```

creating a mosaic plot (plot of proportions)
```{r}
mosaicplot(freq_tbl)
mosaicplot(freq_tbl_education)
```

looking at categorical variables
```{r}
mosaicplot(table(occupation))
```

Stacked bar-plot - i.e. plotting it x-tab
```{r}
freq_xtab=xtabs(~occupation+class)
head(freq_xtab)
```

basic bar-plot will automatically be stacked if we give it the x-tab table as an input
barplot of occupation vs class:
```{r}
barplot(freq_xtab)
barplot(prop.table(freq_xtab))
barplot(prop.table(freq_xtab,2),
        legend=rownames(freq_xtab),  beside = TRUE,
        ylab = "class", xlab = "occupation",
        main = "looking at proportions of different occupations in relation to the 2 salary classes",
       xlim = c(0,70),
       col = viridis(10))
```

look at workclass versus class (2 categorical variables)
```{r}
workclass_vs_class_freq_xtab=xtabs(~workclass+class)
head(workclass_vs_class_freq_xtab)
```
plotting workclass vs class:
```{r}
workclass_vs_class_freq_xtab = table(workclass, class) #create a simple frequency table of workclass vs class
workclass_vs_class_pct_xtab = prop.table(workclass_vs_class_freq_xtab, 2)  #turn into a proportion table
barplot(workclass_vs_class_pct_xtab,
        legend=rownames(workclass_vs_class_pct_xtab), beside = TRUE,
        ylab = "class", xlab = "workclass",
        main = "proportions of workclass in relation to class",
        xlim = c(0, 28),
        col = viridis(10))
```

plotting marital status vs class:
```{r}
marital_status_vs_class_freq_xtab=xtabs(~marital_status+class)
head(marital_status_vs_class_freq_xtab)
```

```{r}
marital_status_vs_class_freq_xtab = table(marital_status,class)
marital_status_vs_class_pct_xtab = prop.table(marital_status_vs_class_freq_xtab,2)
barplot(marital_status_vs_class_pct_xtab,
        legend= rownames(marital_status_vs_class_pct_xtab), beside = TRUE,
        ylab = "class", xlab = "marital status",
        main = "proportions of marital status in relation to class",
        xlim = c(0, 25),   #this is used to move legend to the right
        col = viridis(10))
```

plotting education vs class
```{r}
ggplot(data = data, aes(y = education, fill = class)) +
  geom_bar(position = "stack")   #different bars stacked together
```

```{r}
ggplot(data = data, aes(y = education, fill = class)) +
  geom_bar(position = "dodge")   #different bars side by side
```

plotting native country vs. class
```{r}
ggplot(data = data, aes(y = native_country, fill = class))+
  geom_bar(position = "stack")
```

plotting occupation vs class
```{r}
ggplot(data = data, aes(y = occupation, fill = class))+
  geom_bar(position = "dodge")
```

check missing values for each column in dataset:
```{r}
colSums(is.na(data))
```

missing values are represented by "?" in the dataset

convert ? values to NA in dataset and save into new dataframe:
```{r}
data_NA <- as.data.frame(data %>% 
  mutate_if(is.character, list(~na_if(., " ?"))))

View(data_NA)
```

total missing NA values:
```{r}
sum(is.na(data_NA))
```

compute the total missing values in each column:
```{r}
colSums(is.na(data_NA))
```

missing values 

getting the percentage of missing values:
```{r}
percent_missing = function(x){sum(is.na(x))/length(x)*100}
apply(data_NA,2,percent_missing)
```

visualizing missing values:
install.packages("mice")
```{r}
library(mice)

md.pattern(data_NA)

```
